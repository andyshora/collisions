(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// import { Game } from './Game.js';

'use strict';

paper.install(window);

var SHAPE_RADIUS = 4;
var NUM_SHAPES = 50;

var WIDTH = undefined;
var HEIGHT = undefined;
var shapesArr = [];
var ineligibleShapes = [];
var explodingShapes = [];
var circle = undefined,
    square = undefined,
    hexagon = undefined,
    triangle = undefined,
    trace = undefined;
var move = undefined;
var currentBulletIndex = undefined,
    currentTargetIndex = undefined;

var COLORS = ['rgb(0, 157, 249)', 'rgb(255, 0, 217)', 'rgb(0, 117, 185)', 'rgb(0, 196, 194)'];

var createTracePath = function createTracePath() {
  var path = new Path.Circle(new Point(0, 0), 1);
  path.fillColor = 'rgb(255, 255, 255)';
  return path;
};

var createExplosionPath = function createExplosionPath(radius) {
  var path = new Path.Circle(new Point(0, 0), radius);
  path.fillColor = 'rgb(255, 255, 255)';
  path.opacity = 0.05;

  /*path.fillColor = {
    gradient: {
      stops: [['rgb(0, 117, 185)', 0], ['rgba(0, 117, 185, 0)', 1]],
      radial: true
    },
    origin: path.position,
    destination: path.bounds.rightCenter
  };*/

  return path;
};

var createCirclePath = function createCirclePath() {
  var path = new Path.Circle(new Point(0, 0), SHAPE_RADIUS);
  path.fillColor = COLORS[0];
  return path;
};

var createSquarePath = function createSquarePath() {
  var path = new Path.Rectangle(new Point(0, 0), new Point(SHAPE_RADIUS * 2, SHAPE_RADIUS * 2));

  path.fillColor = COLORS[1];
  return path;
};

var createTrianglePath = function createTrianglePath() {
  var path = new Path.RegularPolygon(new Point(0, 0), 3, SHAPE_RADIUS * 2);
  path.fillColor = COLORS[2];

  return path;
};

var createHexagonPath = function createHexagonPath() {
  // Create a Paper.js Path to draw a line into it:
  var hexagon = new Path();

  var points = 6;
  var radius = SHAPE_RADIUS * 1.6;
  var angle = 2 * Math.PI / points;

  for (var i = 0; i <= points; i++) {
    hexagon.add(new Point(radius * Math.cos(angle * i), radius * Math.sin(angle * i)));
  }

  hexagon.fillColor = COLORS[3];

  return hexagon;
};

var createRandomShape = function createRandomShape(pos) {
  var shapeIndex = chance.integer({ min: 0, max: 3 });
  var path = undefined;

  switch (shapeIndex) {
    case 0:
      path = circle.place(new Point(pos.x, pos.y));
      break;
    case 1:
      path = square.place(new Point(pos.x, pos.y));
      break;
    case 2:
      path = hexagon.place(new Point(pos.x, pos.y));
      break;
    case 3:
      path = triangle.place(new Point(pos.x, pos.y));
      break;
  }
  return path;
};

var tool = undefined;

window.onload = function () {
  var chance = new Chance();
  var canvas = document.getElementById('canvas');
  tool = new Tool();

  WIDTH = window.innerWidth;
  HEIGHT = window.innerHeight;

  console.log(WIDTH, HEIGHT);

  paper.setup(canvas);
  paper.view.onResize = onResize;
  paper.view.onFrame = onFrame;

  tool.onMouseDown = onMouseDown;
  tool.onMouseDrag = onMouseDrag;

  setupShapes();
  fireNewShape();

  setTimeout(function () {
    document.body.className += 'app--loaded';
  }, 2000);
};

var setupShapes = function setupShapes() {
  var circlePath = createCirclePath();
  var squarePath = createSquarePath();
  var trianglePath = createTrianglePath();
  var hexagonPath = createHexagonPath();
  var tracePath = createTracePath();

  circle = new Symbol(circlePath);
  square = new Symbol(squarePath);
  hexagon = new Symbol(hexagonPath);
  triangle = new Symbol(trianglePath);
  trace = new Symbol(tracePath);

  for (var i = 0; i < NUM_SHAPES; i++) {

    var pos = {
      x: chance.integer({ min: 0, max: WIDTH }),
      y: chance.integer({ min: 0, max: HEIGHT })
    };

    var placed = createRandomShape(pos);
    placed.rotate(chance.integer({ min: 0, max: 180 }));
    placed.scale(chance.floating({ min: 0.5, max: 1 }));

    placed.data.eligible = true;

    shapesArr.push(placed);
  }
};

var repositionShapes = function repositionShapes() {
  for (var i = 0; i < shapesArr.length; i++) {

    var pos = {
      x: chance.integer({ min: 0, max: WIDTH }),
      y: chance.integer({ min: 0, max: HEIGHT })
    };

    shapesArr[i].position = pos;
  }
};

var onResize = function onResize(view) {
  WIDTH = view.size.width;
  HEIGHT = view.size.height;

  repositionShapes();
};

var d2r = function d2r(deg) {
  return deg * Math.PI / 180;
};

var onCollide = function onCollide(bullet, target, angle) {
  // console.log('onCollide', bullet);
  // shape has been collided with
  // create a few more shapes at its position
  // then remove it
  bullet.remove();

  for (var i = 0; i < traces.length; i++) {
    traces[i].remove();
  }

  var explosionRadius = chance.integer({ min: 20, max: 60 });
  var numParts = 5;
  var explosionShape = createExplosionPath(explosionRadius);
  explosionShape.position = target.position;

  for (var i = 0; i < numParts; i++) {

    var theta = angle + i * (180 / numParts) - 90;

    var pos = {
      x: target.position.x + explosionRadius * Math.cos(d2r(theta)),
      y: target.position.y + explosionRadius * Math.sin(d2r(theta))
    };

    var placed = createRandomShape(pos);
    placed.rotate(chance.integer({ min: 0, max: 180 }));
    placed.scale(chance.floating({ min: 0.5, max: 1 }));

    placed.data.eligible = false;
    placed.data.origin = target.position;
    placed.data.theta = theta;
    placed.data.parentPosition = target.position;

    explodingShapes.push(placed);
    ineligibleShapes.push(placed);

    shapesArr.push(placed);
  }

  NUM_SHAPES += numParts - 1;
  explosionInProgress = true;

  fireNewShape();
};

var fireNewShape = function fireNewShape() {
  currentBulletIndex = chance.integer({ min: 0, max: shapesArr.length - 1 });

  // ensure no newly created particles are the new target
  currentTargetIndex = chance.integer({ min: 0, max: shapesArr.length - 1 });

  if (shapesArr[currentBulletIndex].data.eligible && currentBulletIndex !== currentTargetIndex && typeof shapesArr[currentBulletIndex]._index !== 'undefined') {
    move = true;
  } else {
    // console.warn('not eligible');
    fireNewShape();
  }
};

var lastShiftedAt = 0;
var shiftEvery = 60;
var explosionInProgress = false;
var traces = [];

var onMouseDown = function onMouseDown(event) {
  console.log(event.point);

  var placed = createRandomShape(event.point);
  placed.rotate(chance.integer({ min: 0, max: 180 }));
  placed.scale(chance.floating({ min: 0.5, max: 1 }));

  placed.data.eligible = true;
  shapesArr.push(placed);
  NUM_SHAPES++;
};

var numDragEvents = 0;

var onMouseDrag = function onMouseDrag(event) {

  if (numDragEvents % 4 === 0) {
    onMouseDown(event);
  }

  numDragEvents++;
};

var onFrame = function onFrame(event) {
  // console.log(event);
  if (move) {
    var vector = shapesArr[currentTargetIndex].position.subtract(shapesArr[currentBulletIndex].position);
    var originalLength = vector.length;

    if (event.count % 2 === 0) {
      traces.push(trace.place(new Point(shapesArr[currentBulletIndex].position)));
    }

    vector.length = WIDTH / 2;
    shapesArr[currentBulletIndex].position = shapesArr[currentBulletIndex].position.add(vector.divide(120));
    shapesArr[currentBulletIndex].rotate(1);

    if (originalLength < 5) {

      move = false;
      onCollide(shapesArr[currentBulletIndex], shapesArr[currentTargetIndex], vector.angle);
    }
  }

  if (explosionInProgress) {
    // move parts out from their origin
    for (var i = 0; i < explodingShapes.length; i++) {
      var vector = explodingShapes[i].data.parentPosition.subtract(explodingShapes[i].position);
      if (vector.length > 100) {
        explodingShapes = [];
      } else {
        explodingShapes[i].position = explodingShapes[i].position.subtract(vector.divide(300));
        explodingShapes[i].rotate(10);
      }
    }
  }

  // enable new shapes as bullets and targets
  if (event.count - lastShiftedAt > shiftEvery && ineligibleShapes.length) {
    shiftEvery = ineligibleShapes.length > 50 ? 1 : 60;
    ineligibleShapes[0].data.eligible = true;
    ineligibleShapes.shift();
    lastShiftedAt = event.count;
  }

  // triangle.definition.rotate(0.5);
  // square.definition.rotate(0.4);
  // hexagon.definition.rotate(0.2);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvYW5keXNob3JhL0Rldi9jb2xsaXNpb25zL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDRUEsWUFBWSxDQUFDOztBQUViLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRXRCLElBQU0sWUFBWSxHQUFHLENBQUMsQ0FBQztBQUN2QixJQUFJLFVBQVUsR0FBRyxFQUFFLENBQUM7O0FBRXBCLElBQUksS0FBSyxZQUFBLENBQUM7QUFDVixJQUFJLE1BQU0sWUFBQSxDQUFDO0FBQ1gsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ25CLElBQUksZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO0FBQzFCLElBQUksZUFBZSxHQUFHLEVBQUUsQ0FBQztBQUN6QixJQUFJLE1BQU0sWUFBQTtJQUFFLE1BQU0sWUFBQTtJQUFFLE9BQU8sWUFBQTtJQUFFLFFBQVEsWUFBQTtJQUFFLEtBQUssWUFBQSxDQUFDO0FBQzdDLElBQUksSUFBSSxZQUFBLENBQUM7QUFDVCxJQUFJLGtCQUFrQixZQUFBO0lBQUUsa0JBQWtCLFlBQUEsQ0FBQzs7QUFFM0MsSUFBTSxNQUFNLEdBQUcsQ0FDYixrQkFBa0IsRUFDbEIsa0JBQWtCLEVBQ2xCLGtCQUFrQixFQUNsQixrQkFBa0IsQ0FDbkIsQ0FBQzs7QUFFRixJQUFNLGVBQWUsR0FBRyxTQUFsQixlQUFlLEdBQVM7QUFDNUIsTUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUMvQyxNQUFJLENBQUMsU0FBUyxHQUFHLG9CQUFvQixDQUFDO0FBQ3RDLFNBQU8sSUFBSSxDQUFDO0NBQ2IsQ0FBQzs7QUFFRixJQUFNLG1CQUFtQixHQUFHLFNBQXRCLG1CQUFtQixDQUFHLE1BQU0s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LElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO0FBQ3pDLG9CQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDO0FBQ3pCLGlCQUFhLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztHQUM3Qjs7Ozs7Q0FNRixDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIGltcG9ydCB7IEdhbWUgfSBmcm9tICcuL0dhbWUuanMnO1xuXG4ndXNlIHN0cmljdCc7XG5cbnBhcGVyLmluc3RhbGwod2luZG93KTtcblxuY29uc3QgU0hBUEVfUkFESVVTID0gNDtcbmxldCBOVU1fU0hBUEVTID0gNTA7XG5cbmxldCBXSURUSDtcbmxldCBIRUlHSFQ7XG5sZXQgc2hhcGVzQXJyID0gW107XG5sZXQgaW5lbGlnaWJsZVNoYXBlcyA9IFtdO1xubGV0IGV4cGxvZGluZ1NoYXBlcyA9IFtdO1xubGV0IGNpcmNsZSwgc3F1YXJlLCBoZXhhZ29uLCB0cmlhbmdsZSwgdHJhY2U7XG5sZXQgbW92ZTtcbmxldCBjdXJyZW50QnVsbGV0SW5kZXgsIGN1cnJlbnRUYXJnZXRJbmRleDtcblxuY29uc3QgQ09MT1JTID0gW1xuICAncmdiKDAsIDE1NywgMjQ5KScsXG4gICdyZ2IoMjU1LCAwLCAyMTcpJyxcbiAgJ3JnYigwLCAxMTcsIDE4NSknLFxuICAncmdiKDAsIDE5NiwgMTk0KSdcbl07XG5cbmNvbnN0IGNyZWF0ZVRyYWNlUGF0aCA9ICgpID0+IHtcbiAgbGV0IHBhdGggPSBuZXcgUGF0aC5DaXJjbGUobmV3IFBvaW50KDAsIDApLCAxKTtcbiAgcGF0aC5maWxsQ29sb3IgPSAncmdiKDI1NSwgMjU1LCAyNTUpJztcbiAgcmV0dXJuIHBhdGg7XG59O1xuXG5jb25zdCBjcmVhdGVFeHBsb3Npb25QYXRoID0gcmFkaXVzID0+IHtcbiAgbGV0IHBhdGggPSBuZXcgUGF0aC5DaXJjbGUobmV3IFBvaW50KDAsIDApLCByYWRpdXMpO1xuICBwYXRoLmZpbGxDb2xvciA9ICdyZ2IoMjU1LCAyNTUsIDI1NSknO1xuICBwYXRoLm9wYWNpdHkgPSAwLjA1O1xuXG4gIC8qcGF0aC5maWxsQ29sb3IgPSB7XG4gICAgZ3JhZGllbnQ6IHtcbiAgICAgIHN0b3BzOiBbWydyZ2IoMCwgMTE3LCAxODUpJywgMF0sIFsncmdiYSgwLCAxMTcsIDE4NSwgMCknLCAxXV0sXG4gICAgICByYWRpYWw6IHRydWVcbiAgICB9LFxuICAgIG9yaWdpbjogcGF0aC5wb3NpdGlvbixcbiAgICBkZXN0aW5hdGlvbjogcGF0aC5ib3VuZHMucmlnaHRDZW50ZXJcbiAgfTsqL1xuXG4gIHJldHVybiBwYXRoO1xufTtcblxuY29uc3QgY3JlYXRlQ2lyY2xlUGF0aCA9ICgpID0+IHtcbiAgbGV0IHBhdGggPSBuZXcgUGF0aC5DaXJjbGUobmV3IFBvaW50KDAsIDApLCBTSEFQRV9SQURJVVMpO1xuICBwYXRoLmZpbGxDb2xvciA9IENPTE9SU1swXTtcbiAgcmV0dXJuIHBhdGg7XG59O1xuXG5jb25zdCBjcmVhdGVTcXVhcmVQYXRoID0gKCkgPT4ge1xuICBsZXQgcGF0aCA9IG5ldyBQYXRoLlJlY3RhbmdsZShuZXcgUG9pbnQoMCwgMCksIG5ldyBQb2ludChTSEFQRV9SQURJVVMgKiAyLCBTSEFQRV9SQURJVVMgKiAyKSk7XG5cbiAgcGF0aC5maWxsQ29sb3IgPSBDT0xPUlNbMV07XG4gIHJldHVybiBwYXRoO1xufTtcblxuY29uc3QgY3JlYXRlVHJpYW5nbGVQYXRoID0gKCkgPT4ge1xuICBsZXQgcGF0aCA9IG5ldyBQYXRoLlJlZ3VsYXJQb2x5Z29uKG5ldyBQb2ludCgwLCAwKSwgMywgU0hBUEVfUkFESVVTICogMik7XG4gIHBhdGguZmlsbENvbG9yID0gQ09MT1JTWzJdO1xuXG4gIHJldHVybiBwYXRoO1xufTtcblxuY29uc3QgY3JlYXRlSGV4YWdvblBhdGggPSAoKSA9PiB7XG4gIC8vIENyZWF0ZSBhIFBhcGVyLmpzIFBhdGggdG8gZHJhdyBhIGxpbmUgaW50byBpdDpcbiAgdmFyIGhleGFnb24gPSBuZXcgUGF0aCgpO1xuXG4gIHZhciBwb2ludHMgPSA2O1xuICB2YXIgcmFkaXVzID0gU0hBUEVfUkFESVVTICogMS42O1xuICB2YXIgYW5nbGUgPSAoKDIgKiBNYXRoLlBJKSAvIHBvaW50cyk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gcG9pbnRzOyBpKyspIHtcbiAgICBoZXhhZ29uLmFkZChuZXcgUG9pbnQoXG4gICAgICByYWRpdXMgKiBNYXRoLmNvcyhhbmdsZSAqIGkpLFxuICAgICAgcmFkaXVzICogTWF0aC5zaW4oYW5nbGUgKiBpKVxuICAgICkpO1xuICB9XG5cbiAgaGV4YWdvbi5maWxsQ29sb3IgPSBDT0xPUlNbM107XG5cbiAgcmV0dXJuIGhleGFnb247XG59O1xuXG5jb25zdCBjcmVhdGVSYW5kb21TaGFwZSA9IHBvcyA9PiB7XG4gIGNvbnN0IHNoYXBlSW5kZXggPSBjaGFuY2UuaW50ZWdlcih7IG1pbjogMCwgbWF4OiAzIH0pO1xuICBsZXQgcGF0aDtcblxuICBzd2l0Y2ggKHNoYXBlSW5kZXgpIHtcbiAgY2FzZSAwOlxuICAgIHBhdGggPSBjaXJjbGUucGxhY2UobmV3IFBvaW50KHBvcy54LCBwb3MueSkpO1xuICAgIGJyZWFrO1xuICBjYXNlIDE6XG4gICAgcGF0aCA9IHNxdWFyZS5wbGFjZShuZXcgUG9pbnQocG9zLngsIHBvcy55KSk7XG4gICAgYnJlYWs7XG4gIGNhc2UgMjpcbiAgICBwYXRoID0gaGV4YWdvbi5wbGFjZShuZXcgUG9pbnQocG9zLngsIHBvcy55KSk7XG4gICAgYnJlYWs7XG4gIGNhc2UgMzpcbiAgICBwYXRoID0gdHJpYW5nbGUucGxhY2UobmV3IFBvaW50KHBvcy54LCBwb3MueSkpO1xuICAgIGJyZWFrO1xuICB9XG4gIHJldHVybiBwYXRoO1xufVxuXG5sZXQgdG9vbDtcblxud2luZG93Lm9ubG9hZCA9ICgpID0+IHtcbiAgbGV0IGNoYW5jZSA9IG5ldyBDaGFuY2UoKTtcbiAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXMnKTtcbiAgdG9vbCA9IG5ldyBUb29sKCk7XG5cbiAgV0lEVEggPSB3aW5kb3cuaW5uZXJXaWR0aDtcbiAgSEVJR0hUID0gd2luZG93LmlubmVySGVpZ2h0O1xuXG4gIGNvbnNvbGUubG9nKFdJRFRILCBIRUlHSFQpO1xuXG4gIHBhcGVyLnNldHVwKGNhbnZhcyk7XG4gIHBhcGVyLnZpZXcub25SZXNpemUgPSBvblJlc2l6ZTtcbiAgcGFwZXIudmlldy5vbkZyYW1lID0gb25GcmFtZTtcblxuICB0b29sLm9uTW91c2VEb3duID0gb25Nb3VzZURvd247XG4gIHRvb2wub25Nb3VzZURyYWcgPSBvbk1vdXNlRHJhZztcblxuICBzZXR1cFNoYXBlcygpO1xuICBmaXJlTmV3U2hhcGUoKTtcblxuICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICBkb2N1bWVudC5ib2R5LmNsYXNzTmFtZSArPSAnYXBwLS1sb2FkZWQnO1xuICB9LCAyMDAwKTtcblxufTtcblxuY29uc3Qgc2V0dXBTaGFwZXMgPSAoKSA9PiB7XG4gIGxldCBjaXJjbGVQYXRoID0gY3JlYXRlQ2lyY2xlUGF0aCgpO1xuICBsZXQgc3F1YXJlUGF0aCA9IGNyZWF0ZVNxdWFyZVBhdGgoKTtcbiAgbGV0IHRyaWFuZ2xlUGF0aCA9IGNyZWF0ZVRyaWFuZ2xlUGF0aCgpO1xuICBsZXQgaGV4YWdvblBhdGggPSBjcmVhdGVIZXhhZ29uUGF0aCgpO1xuICBsZXQgdHJhY2VQYXRoID0gY3JlYXRlVHJhY2VQYXRoKCk7XG5cbiAgY2lyY2xlID0gbmV3IFN5bWJvbChjaXJjbGVQYXRoKTtcbiAgc3F1YXJlID0gbmV3IFN5bWJvbChzcXVhcmVQYXRoKTtcbiAgaGV4YWdvbiA9IG5ldyBTeW1ib2woaGV4YWdvblBhdGgpO1xuICB0cmlhbmdsZSA9IG5ldyBTeW1ib2wodHJpYW5nbGVQYXRoKTtcbiAgdHJhY2UgPSBuZXcgU3ltYm9sKHRyYWNlUGF0aCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1fU0hBUEVTOyBpKyspIHtcblxuICAgIGxldCBwb3MgPSB7XG4gICAgICB4OiBjaGFuY2UuaW50ZWdlcih7IG1pbjogMCwgbWF4OiBXSURUSCB9KSxcbiAgICAgIHk6IGNoYW5jZS5pbnRlZ2VyKHsgbWluOiAwLCBtYXg6IEhFSUdIVCB9KVxuICAgIH07XG5cbiAgICBsZXQgcGxhY2VkID0gY3JlYXRlUmFuZG9tU2hhcGUocG9zKTtcbiAgICBwbGFjZWQucm90YXRlKGNoYW5jZS5pbnRlZ2VyKHsgbWluOiAwLCBtYXg6IDE4MCB9KSk7XG4gICAgcGxhY2VkLnNjYWxlKGNoYW5jZS5mbG9hdGluZyh7IG1pbjogMC41LCBtYXg6IDEgfSkpO1xuXG4gICAgcGxhY2VkLmRhdGEuZWxpZ2libGUgPSB0cnVlO1xuXG4gICAgc2hhcGVzQXJyLnB1c2gocGxhY2VkKTtcbiAgfVxuXG5cbn07XG5cbmNvbnN0IHJlcG9zaXRpb25TaGFwZXMgPSAoKSA9PiB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgc2hhcGVzQXJyLmxlbmd0aDsgaSsrKSB7XG5cbiAgICBsZXQgcG9zID0ge1xuICAgICAgeDogY2hhbmNlLmludGVnZXIoeyBtaW46IDAsIG1heDogV0lEVEggfSksXG4gICAgICB5OiBjaGFuY2UuaW50ZWdlcih7IG1pbjogMCwgbWF4OiBIRUlHSFQgfSlcbiAgICB9O1xuXG4gICAgc2hhcGVzQXJyW2ldLnBvc2l0aW9uID0gcG9zO1xuICB9XG59O1xuXG5jb25zdCBvblJlc2l6ZSA9IHZpZXcgPT4ge1xuICBXSURUSCA9IHZpZXcuc2l6ZS53aWR0aDtcbiAgSEVJR0hUID0gdmlldy5zaXplLmhlaWdodDtcblxuICByZXBvc2l0aW9uU2hhcGVzKCk7XG59O1xuXG5jb25zdCBkMnIgPSBkZWcgPT4ge1xuICByZXR1cm4gZGVnICogTWF0aC5QSSAvIDE4MDtcbn07XG5cbmNvbnN0IG9uQ29sbGlkZSA9IChidWxsZXQsIHRhcmdldCwgYW5nbGUpID0+IHtcbiAgLy8gY29uc29sZS5sb2coJ29uQ29sbGlkZScsIGJ1bGxldCk7XG4gIC8vIHNoYXBlIGhhcyBiZWVuIGNvbGxpZGVkIHdpdGhcbiAgLy8gY3JlYXRlIGEgZmV3IG1vcmUgc2hhcGVzIGF0IGl0cyBwb3NpdGlvblxuICAvLyB0aGVuIHJlbW92ZSBpdFxuICBidWxsZXQucmVtb3ZlKCk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmFjZXMubGVuZ3RoOyBpKyspIHtcbiAgICB0cmFjZXNbaV0ucmVtb3ZlKCk7XG4gIH1cblxuICBjb25zdCBleHBsb3Npb25SYWRpdXMgPSBjaGFuY2UuaW50ZWdlcih7IG1pbjogMjAsIG1heDogNjAgfSk7XG4gIGNvbnN0IG51bVBhcnRzID0gNTtcbiAgbGV0IGV4cGxvc2lvblNoYXBlID0gY3JlYXRlRXhwbG9zaW9uUGF0aChleHBsb3Npb25SYWRpdXMpO1xuICBleHBsb3Npb25TaGFwZS5wb3NpdGlvbiA9IHRhcmdldC5wb3NpdGlvbjtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVBhcnRzOyBpKyspIHtcblxuICAgIGNvbnN0IHRoZXRhID0gYW5nbGUgKyAoaSAqICgxODAgLyBudW1QYXJ0cykpIC0gOTA7XG5cbiAgICBsZXQgcG9zID0ge1xuICAgICAgeDogdGFyZ2V0LnBvc2l0aW9uLnggKyAoZXhwbG9zaW9uUmFkaXVzICogTWF0aC5jb3MoZDJyKHRoZXRhKSkpLFxuICAgICAgeTogdGFyZ2V0LnBvc2l0aW9uLnkgKyAoZXhwbG9zaW9uUmFkaXVzICogTWF0aC5zaW4oZDJyKHRoZXRhKSkpXG4gICAgfTtcblxuICAgIGxldCBwbGFjZWQgPSBjcmVhdGVSYW5kb21TaGFwZShwb3MpO1xuICAgIHBsYWNlZC5yb3RhdGUoY2hhbmNlLmludGVnZXIoeyBtaW46IDAsIG1heDogMTgwIH0pKTtcbiAgICBwbGFjZWQuc2NhbGUoY2hhbmNlLmZsb2F0aW5nKHsgbWluOiAwLjUsIG1heDogMSB9KSk7XG5cbiAgICBwbGFjZWQuZGF0YS5lbGlnaWJsZSA9IGZhbHNlO1xuICAgIHBsYWNlZC5kYXRhLm9yaWdpbiA9IHRhcmdldC5wb3NpdGlvbjtcbiAgICBwbGFjZWQuZGF0YS50aGV0YSA9IHRoZXRhO1xuICAgIHBsYWNlZC5kYXRhLnBhcmVudFBvc2l0aW9uID0gdGFyZ2V0LnBvc2l0aW9uO1xuXG4gICAgZXhwbG9kaW5nU2hhcGVzLnB1c2gocGxhY2VkKTtcbiAgICBpbmVsaWdpYmxlU2hhcGVzLnB1c2gocGxhY2VkKTtcblxuICAgIHNoYXBlc0Fyci5wdXNoKHBsYWNlZCk7XG4gIH1cblxuICBOVU1fU0hBUEVTICs9IG51bVBhcnRzIC0gMTtcbiAgZXhwbG9zaW9uSW5Qcm9ncmVzcyA9IHRydWU7XG5cbiAgZmlyZU5ld1NoYXBlKCk7XG5cbn07XG5cbmNvbnN0IGZpcmVOZXdTaGFwZSA9ICgpID0+IHtcbiAgY3VycmVudEJ1bGxldEluZGV4ID0gY2hhbmNlLmludGVnZXIoeyBtaW46IDAsIG1heDogc2hhcGVzQXJyLmxlbmd0aCAtIDEgfSk7XG5cbiAgLy8gZW5zdXJlIG5vIG5ld2x5IGNyZWF0ZWQgcGFydGljbGVzIGFyZSB0aGUgbmV3IHRhcmdldFxuICBjdXJyZW50VGFyZ2V0SW5kZXggPSBjaGFuY2UuaW50ZWdlcih7IG1pbjogMCwgbWF4OiBzaGFwZXNBcnIubGVuZ3RoIC0gMSB9KTtcblxuICBpZiAoc2hhcGVzQXJyW2N1cnJlbnRCdWxsZXRJbmRleF0uZGF0YS5lbGlnaWJsZVxuICAgICYmIGN1cnJlbnRCdWxsZXRJbmRleCAhPT0gY3VycmVudFRhcmdldEluZGV4XG4gICAgJiYgdHlwZW9mIHNoYXBlc0FycltjdXJyZW50QnVsbGV0SW5kZXhdLl9pbmRleCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICBtb3ZlID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICAvLyBjb25zb2xlLndhcm4oJ25vdCBlbGlnaWJsZScpO1xuICAgIGZpcmVOZXdTaGFwZSgpO1xuICB9XG5cbn07XG5cbmxldCBsYXN0U2hpZnRlZEF0ID0gMDtcbmxldCBzaGlmdEV2ZXJ5ID0gNjA7XG5sZXQgZXhwbG9zaW9uSW5Qcm9ncmVzcyA9IGZhbHNlO1xubGV0IHRyYWNlcyA9IFtdO1xuXG5jb25zdCBvbk1vdXNlRG93biA9IGV2ZW50ID0+IHtcbiAgY29uc29sZS5sb2coZXZlbnQucG9pbnQpO1xuXG4gIGxldCBwbGFjZWQgPSBjcmVhdGVSYW5kb21TaGFwZShldmVudC5wb2ludCk7XG4gIHBsYWNlZC5yb3RhdGUoY2hhbmNlLmludGVnZXIoeyBtaW46IDAsIG1heDogMTgwIH0pKTtcbiAgcGxhY2VkLnNjYWxlKGNoYW5jZS5mbG9hdGluZyh7IG1pbjogMC41LCBtYXg6IDEgfSkpO1xuXG4gIHBsYWNlZC5kYXRhLmVsaWdpYmxlID0gdHJ1ZTtcbiAgc2hhcGVzQXJyLnB1c2gocGxhY2VkKTtcbiAgTlVNX1NIQVBFUysrO1xufTtcblxubGV0IG51bURyYWdFdmVudHMgPSAwO1xuXG5jb25zdCBvbk1vdXNlRHJhZyA9IGV2ZW50ID0+IHtcblxuICBpZiAobnVtRHJhZ0V2ZW50cyAlIDQgPT09IDApIHtcbiAgICBvbk1vdXNlRG93bihldmVudCk7XG5cbiAgfVxuXG4gIG51bURyYWdFdmVudHMrKztcbn07XG5cbmNvbnN0IG9uRnJhbWUgPSBldmVudCA9PiB7XG4gIC8vIGNvbnNvbGUubG9nKGV2ZW50KTtcbiAgaWYgKG1vdmUpIHtcbiAgICBsZXQgdmVjdG9yID0gc2hhcGVzQXJyW2N1cnJlbnRUYXJnZXRJbmRleF0ucG9zaXRpb24uc3VidHJhY3Qoc2hhcGVzQXJyW2N1cnJlbnRCdWxsZXRJbmRleF0ucG9zaXRpb24pO1xuICAgIGNvbnN0IG9yaWdpbmFsTGVuZ3RoID0gdmVjdG9yLmxlbmd0aDtcblxuICAgIGlmIChldmVudC5jb3VudCAlIDIgPT09IDApIHtcbiAgICAgIHRyYWNlcy5wdXNoKHRyYWNlLnBsYWNlKG5ldyBQb2ludChzaGFwZXNBcnJbY3VycmVudEJ1bGxldEluZGV4XS5wb3NpdGlvbikpKTtcblxuICAgIH1cblxuICAgIHZlY3Rvci5sZW5ndGggPSBXSURUSCAvIDI7XG4gICAgc2hhcGVzQXJyW2N1cnJlbnRCdWxsZXRJbmRleF0ucG9zaXRpb24gPSBzaGFwZXNBcnJbY3VycmVudEJ1bGxldEluZGV4XS5wb3NpdGlvbi5hZGQodmVjdG9yLmRpdmlkZSgxMjApKTtcbiAgICBzaGFwZXNBcnJbY3VycmVudEJ1bGxldEluZGV4XS5yb3RhdGUoMSk7XG5cbiAgICBpZiAob3JpZ2luYWxMZW5ndGggPCA1KSB7XG5cbiAgICAgIG1vdmUgPSBmYWxzZTtcbiAgICAgIG9uQ29sbGlkZShzaGFwZXNBcnJbY3VycmVudEJ1bGxldEluZGV4XSwgc2hhcGVzQXJyW2N1cnJlbnRUYXJnZXRJbmRleF0sIHZlY3Rvci5hbmdsZSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGV4cGxvc2lvbkluUHJvZ3Jlc3MpIHtcbiAgICAvLyBtb3ZlIHBhcnRzIG91dCBmcm9tIHRoZWlyIG9yaWdpblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXhwbG9kaW5nU2hhcGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgdmVjdG9yID0gZXhwbG9kaW5nU2hhcGVzW2ldLmRhdGEucGFyZW50UG9zaXRpb24uc3VidHJhY3QoZXhwbG9kaW5nU2hhcGVzW2ldLnBvc2l0aW9uKTtcbiAgICAgIGlmICh2ZWN0b3IubGVuZ3RoID4gMTAwKSB7XG4gICAgICAgIGV4cGxvZGluZ1NoYXBlcyA9IFtdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXhwbG9kaW5nU2hhcGVzW2ldLnBvc2l0aW9uID0gZXhwbG9kaW5nU2hhcGVzW2ldLnBvc2l0aW9uLnN1YnRyYWN0KHZlY3Rvci5kaXZpZGUoMzAwKSk7XG4gICAgICAgIGV4cGxvZGluZ1NoYXBlc1tpXS5yb3RhdGUoMTApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGVuYWJsZSBuZXcgc2hhcGVzIGFzIGJ1bGxldHMgYW5kIHRhcmdldHNcbiAgaWYgKChldmVudC5jb3VudCAtIGxhc3RTaGlmdGVkQXQgPiBzaGlmdEV2ZXJ5KSAmJiBpbmVsaWdpYmxlU2hhcGVzLmxlbmd0aCkge1xuICAgIHNoaWZ0RXZlcnkgPSBpbmVsaWdpYmxlU2hhcGVzLmxlbmd0aCA+IDUwID8gMSA6IDYwO1xuICAgIGluZWxpZ2libGVTaGFwZXNbMF0uZGF0YS5lbGlnaWJsZSA9IHRydWU7XG4gICAgaW5lbGlnaWJsZVNoYXBlcy5zaGlmdCgpO1xuICAgIGxhc3RTaGlmdGVkQXQgPSBldmVudC5jb3VudDtcbiAgfVxuXG4gIC8vIHRyaWFuZ2xlLmRlZmluaXRpb24ucm90YXRlKDAuNSk7XG4gIC8vIHNxdWFyZS5kZWZpbml0aW9uLnJvdGF0ZSgwLjQpO1xuICAvLyBoZXhhZ29uLmRlZmluaXRpb24ucm90YXRlKDAuMik7XG5cbn07XG4iXX0=
