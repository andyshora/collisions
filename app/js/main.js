(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// import { Game } from './Game.js';

'use strict';

paper.install(window);

var SHAPE_RADIUS = 4;
var NUM_SHAPES = 50;

var WIDTH = undefined;
var HEIGHT = undefined;
var shapesArr = [];
var ineligibleShapes = [];
var explodingShapes = [];
var circle = undefined,
    square = undefined,
    hexagon = undefined,
    triangle = undefined,
    trace = undefined;
var move = undefined;
var currentBulletIndex = undefined,
    currentTargetIndex = undefined;

var COLORS = ['rgb(0, 157, 249)', 'rgb(255, 0, 217)', 'rgb(0, 117, 185)', 'rgb(0, 196, 194)'];

var createTracePath = function createTracePath() {
  var path = new Path.Circle(new Point(0, 0), 1);
  path.fillColor = 'rgb(255, 255, 255)';
  return path;
};

var createExplosionPath = function createExplosionPath(radius) {
  var path = new Path.Circle(new Point(0, 0), radius);
  path.fillColor = 'rgb(255, 255, 255)';
  path.opacity = 0.05;

  /*path.fillColor = {
    gradient: {
      stops: [['rgb(0, 117, 185)', 0], ['rgba(0, 117, 185, 0)', 1]],
      radial: true
    },
    origin: path.position,
    destination: path.bounds.rightCenter
  };*/

  return path;
};

var createCirclePath = function createCirclePath() {
  var path = new Path.Circle(new Point(0, 0), SHAPE_RADIUS);
  path.fillColor = COLORS[0];
  return path;
};

var createSquarePath = function createSquarePath() {
  var path = new Path.Rectangle(new Point(0, 0), new Point(SHAPE_RADIUS * 2, SHAPE_RADIUS * 2));

  path.fillColor = COLORS[1];
  return path;
};

var createTrianglePath = function createTrianglePath() {
  var path = new Path.RegularPolygon(new Point(0, 0), 3, SHAPE_RADIUS * 2);
  path.fillColor = COLORS[2];

  return path;
};

var createHexagonPath = function createHexagonPath() {
  // Create a Paper.js Path to draw a line into it:
  var hexagon = new Path();

  var points = 6;
  var radius = SHAPE_RADIUS * 1.6;
  var angle = 2 * Math.PI / points;

  for (var i = 0; i <= points; i++) {
    hexagon.add(new Point(radius * Math.cos(angle * i), radius * Math.sin(angle * i)));
  }

  hexagon.fillColor = COLORS[3];

  return hexagon;
};

var createRandomShape = function createRandomShape(pos) {
  var shapeIndex = chance.integer({ min: 0, max: 3 });
  var path = undefined;

  switch (shapeIndex) {
    case 0:
      path = circle.place(new Point(pos.x, pos.y));
      break;
    case 1:
      path = square.place(new Point(pos.x, pos.y));
      break;
    case 2:
      path = hexagon.place(new Point(pos.x, pos.y));
      break;
    case 3:
      path = triangle.place(new Point(pos.x, pos.y));
      break;
  }
  return path;
};

var tool = undefined;

window.onload = function () {
  var chance = new Chance();
  var canvas = document.getElementById('canvas');
  tool = new Tool();

  WIDTH = window.innerWidth;
  HEIGHT = window.innerHeight;

  console.log(WIDTH, HEIGHT);

  paper.setup(canvas);
  paper.view.onResize = onResize;
  paper.view.onFrame = onFrame;

  tool.onMouseDown = onMouseDown;
  tool.onMouseDrag = onMouseDrag;

  setupShapes();
  fireNewShape();
};

var setupShapes = function setupShapes() {
  var circlePath = createCirclePath();
  var squarePath = createSquarePath();
  var trianglePath = createTrianglePath();
  var hexagonPath = createHexagonPath();
  var tracePath = createTracePath();

  circle = new Symbol(circlePath);
  square = new Symbol(squarePath);
  hexagon = new Symbol(hexagonPath);
  triangle = new Symbol(trianglePath);
  trace = new Symbol(tracePath);

  for (var i = 0; i < NUM_SHAPES; i++) {

    var pos = {
      x: chance.integer({ min: 0, max: WIDTH }),
      y: chance.integer({ min: 0, max: HEIGHT })
    };

    var placed = createRandomShape(pos);
    placed.rotate(chance.integer({ min: 0, max: 180 }));
    placed.scale(chance.floating({ min: 0.5, max: 1 }));

    placed.data.eligible = true;

    shapesArr.push(placed);
  }
};

var repositionShapes = function repositionShapes() {
  for (var i = 0; i < shapesArr.length; i++) {

    var pos = {
      x: chance.integer({ min: 0, max: WIDTH }),
      y: chance.integer({ min: 0, max: HEIGHT })
    };

    shapesArr[i].position = pos;
  }
};

var onResize = function onResize(view) {
  WIDTH = view.size.width;
  HEIGHT = view.size.height;

  repositionShapes();
};

var d2r = function d2r(deg) {
  return deg * Math.PI / 180;
};

var onCollide = function onCollide(bullet, target, angle) {
  // console.log('onCollide', bullet);
  // shape has been collided with
  // create a few more shapes at its position
  // then remove it
  bullet.remove();

  for (var i = 0; i < traces.length; i++) {
    traces[i].remove();
  }

  var explosionRadius = chance.integer({ min: 20, max: 60 });
  var numParts = 5;
  var explosionShape = createExplosionPath(explosionRadius);
  explosionShape.position = target.position;

  for (var i = 0; i < numParts; i++) {

    var theta = angle + i * (180 / numParts) - 90;

    var pos = {
      x: target.position.x + explosionRadius * Math.cos(d2r(theta)),
      y: target.position.y + explosionRadius * Math.sin(d2r(theta))
    };

    var placed = createRandomShape(pos);
    placed.rotate(chance.integer({ min: 0, max: 180 }));
    placed.scale(chance.floating({ min: 0.5, max: 1 }));

    placed.data.eligible = false;
    placed.data.origin = target.position;
    placed.data.theta = theta;
    placed.data.parentPosition = target.position;

    explodingShapes.push(placed);
    ineligibleShapes.push(placed);

    shapesArr.push(placed);
  }

  NUM_SHAPES += numParts - 1;
  explosionInProgress = true;

  fireNewShape();
};

var fireNewShape = function fireNewShape() {
  currentBulletIndex = chance.integer({ min: 0, max: shapesArr.length - 1 });

  // ensure no newly created particles are the new target
  currentTargetIndex = chance.integer({ min: 0, max: shapesArr.length - 1 });

  if (shapesArr[currentBulletIndex].data.eligible && currentBulletIndex !== currentTargetIndex && typeof shapesArr[currentBulletIndex]._index !== 'undefined') {
    move = true;
  } else {
    // console.warn('not eligible');
    fireNewShape();
  }
};

var lastShiftedAt = 0;
var shiftEvery = 60;
var explosionInProgress = false;
var traces = [];

var onMouseDown = function onMouseDown(event) {
  console.log(event.point);

  var placed = createRandomShape(event.point);
  placed.rotate(chance.integer({ min: 0, max: 180 }));
  placed.scale(chance.floating({ min: 0.5, max: 1 }));

  placed.data.eligible = true;
  shapesArr.push(placed);
  NUM_SHAPES++;
};

var numDragEvents = 0;

var onMouseDrag = function onMouseDrag(event) {

  if (numDragEvents % 4 === 0) {
    onMouseDown(event);
  }

  numDragEvents++;
};

var onFrame = function onFrame(event) {
  // console.log(event);
  if (move) {
    var vector = shapesArr[currentTargetIndex].position.subtract(shapesArr[currentBulletIndex].position);
    var originalLength = vector.length;

    if (event.count % 2 === 0) {
      traces.push(trace.place(new Point(shapesArr[currentBulletIndex].position)));
    }

    vector.length = WIDTH / 2;
    shapesArr[currentBulletIndex].position = shapesArr[currentBulletIndex].position.add(vector.divide(120));
    shapesArr[currentBulletIndex].rotate(1);

    if (originalLength < 5) {

      move = false;
      onCollide(shapesArr[currentBulletIndex], shapesArr[currentTargetIndex], vector.angle);
    }
  }

  if (explosionInProgress) {
    // move parts out from their origin
    for (var i = 0; i < explodingShapes.length; i++) {
      var vector = explodingShapes[i].data.parentPosition.subtract(explodingShapes[i].position);
      if (vector.length > 100) {
        explodingShapes = [];
      } else {
        explodingShapes[i].position = explodingShapes[i].position.subtract(vector.divide(300));
        explodingShapes[i].rotate(10);
      }
    }
  }

  // enable new shapes as bullets and targets
  if (event.count - lastShiftedAt > shiftEvery && ineligibleShapes.length) {
    shiftEvery = ineligibleShapes.length > 50 ? 1 : 60;
    ineligibleShapes[0].data.eligible = true;
    ineligibleShapes.shift();
    lastShiftedAt = event.count;
  }

  // triangle.definition.rotate(0.5);
  // square.definition.rotate(0.4);
  // hexagon.definition.rotate(0.2);
};

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvYW5keXNob3JhL0Rldi9jb2xsaXNpb25zL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDRUEsWUFBWSxDQUFDOztBQUViLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRXRCLElBQU0sWUFBWSxHQUFHLENBQUMsQ0FBQztBQUN2QixJQUFJLFVBQVUsR0FBRyxFQUFFLENBQUM7O0FBRXBCLElBQUksS0FBSyxZQUFBLENBQUM7QUFDVixJQUFJLE1BQU0sWUFBQSxDQUFDO0FBQ1gsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ25CLElBQUksZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO0FBQzFCLElBQUksZUFBZSxHQUFHLEVBQUUsQ0FBQztBQUN6QixJQUFJLE1BQU0sWUFBQTtJQUFFLE1BQU0sWUFBQTtJQUFFLE9BQU8sWUFBQTtJQUFFLFFBQVEsWUFBQTtJQUFFLEtBQUssWUFBQSxDQUFDO0FBQzdDLElBQUksSUFBSSxZQUFBLENBQUM7QUFDVCxJQUFJLGtCQUFrQixZQUFBO0lBQUUsa0JBQWtCLFlBQUEsQ0FBQzs7QUFFM0MsSUFBTSxNQUFNLEdBQUcsQ0FDYixrQkFBa0IsRUFDbEIsa0JBQWtCLEVBQ2xCLGtCQUFrQixFQUNsQixrQkFBa0IsQ0FDbkIsQ0FBQzs7QUFFRixJQUFNLGVBQWUsR0FBRyxTQUFsQixlQUFlLEdBQVM7QUFDNUIsTUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUMvQyxNQUFJLENBQUMsU0FBUyxHQUFHLG9CQUFvQixDQUFDO0FBQ3RDLFNBQU8sSUFBSSxDQUFDO0NBQ2IsQ0FBQzs7QUFFRixJQUFNLG1CQUFtQixHQUFHLFNBQXRCLG1CQUFtQixDQUFHLE1BQU0s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S0FBSyxDQUFDO0dBQzdCOzs7OztDQU1GLENBQUMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gaW1wb3J0IHsgR2FtZSB9IGZyb20gJy4vR2FtZS5qcyc7XG5cbid1c2Ugc3RyaWN0JztcblxucGFwZXIuaW5zdGFsbCh3aW5kb3cpO1xuXG5jb25zdCBTSEFQRV9SQURJVVMgPSA0O1xubGV0IE5VTV9TSEFQRVMgPSA1MDtcblxubGV0IFdJRFRIO1xubGV0IEhFSUdIVDtcbmxldCBzaGFwZXNBcnIgPSBbXTtcbmxldCBpbmVsaWdpYmxlU2hhcGVzID0gW107XG5sZXQgZXhwbG9kaW5nU2hhcGVzID0gW107XG5sZXQgY2lyY2xlLCBzcXVhcmUsIGhleGFnb24sIHRyaWFuZ2xlLCB0cmFjZTtcbmxldCBtb3ZlO1xubGV0IGN1cnJlbnRCdWxsZXRJbmRleCwgY3VycmVudFRhcmdldEluZGV4O1xuXG5jb25zdCBDT0xPUlMgPSBbXG4gICdyZ2IoMCwgMTU3LCAyNDkpJyxcbiAgJ3JnYigyNTUsIDAsIDIxNyknLFxuICAncmdiKDAsIDExNywgMTg1KScsXG4gICdyZ2IoMCwgMTk2LCAxOTQpJ1xuXTtcblxuY29uc3QgY3JlYXRlVHJhY2VQYXRoID0gKCkgPT4ge1xuICBsZXQgcGF0aCA9IG5ldyBQYXRoLkNpcmNsZShuZXcgUG9pbnQoMCwgMCksIDEpO1xuICBwYXRoLmZpbGxDb2xvciA9ICdyZ2IoMjU1LCAyNTUsIDI1NSknO1xuICByZXR1cm4gcGF0aDtcbn07XG5cbmNvbnN0IGNyZWF0ZUV4cGxvc2lvblBhdGggPSByYWRpdXMgPT4ge1xuICBsZXQgcGF0aCA9IG5ldyBQYXRoLkNpcmNsZShuZXcgUG9pbnQoMCwgMCksIHJhZGl1cyk7XG4gIHBhdGguZmlsbENvbG9yID0gJ3JnYigyNTUsIDI1NSwgMjU1KSc7XG4gIHBhdGgub3BhY2l0eSA9IDAuMDU7XG5cbiAgLypwYXRoLmZpbGxDb2xvciA9IHtcbiAgICBncmFkaWVudDoge1xuICAgICAgc3RvcHM6IFtbJ3JnYigwLCAxMTcsIDE4NSknLCAwXSwgWydyZ2JhKDAsIDExNywgMTg1LCAwKScsIDFdXSxcbiAgICAgIHJhZGlhbDogdHJ1ZVxuICAgIH0sXG4gICAgb3JpZ2luOiBwYXRoLnBvc2l0aW9uLFxuICAgIGRlc3RpbmF0aW9uOiBwYXRoLmJvdW5kcy5yaWdodENlbnRlclxuICB9OyovXG5cbiAgcmV0dXJuIHBhdGg7XG59O1xuXG5jb25zdCBjcmVhdGVDaXJjbGVQYXRoID0gKCkgPT4ge1xuICBsZXQgcGF0aCA9IG5ldyBQYXRoLkNpcmNsZShuZXcgUG9pbnQoMCwgMCksIFNIQVBFX1JBRElVUyk7XG4gIHBhdGguZmlsbENvbG9yID0gQ09MT1JTWzBdO1xuICByZXR1cm4gcGF0aDtcbn07XG5cbmNvbnN0IGNyZWF0ZVNxdWFyZVBhdGggPSAoKSA9PiB7XG4gIGxldCBwYXRoID0gbmV3IFBhdGguUmVjdGFuZ2xlKG5ldyBQb2ludCgwLCAwKSwgbmV3IFBvaW50KFNIQVBFX1JBRElVUyAqIDIsIFNIQVBFX1JBRElVUyAqIDIpKTtcblxuICBwYXRoLmZpbGxDb2xvciA9IENPTE9SU1sxXTtcbiAgcmV0dXJuIHBhdGg7XG59O1xuXG5jb25zdCBjcmVhdGVUcmlhbmdsZVBhdGggPSAoKSA9PiB7XG4gIGxldCBwYXRoID0gbmV3IFBhdGguUmVndWxhclBvbHlnb24obmV3IFBvaW50KDAsIDApLCAzLCBTSEFQRV9SQURJVVMgKiAyKTtcbiAgcGF0aC5maWxsQ29sb3IgPSBDT0xPUlNbMl07XG5cbiAgcmV0dXJuIHBhdGg7XG59O1xuXG5jb25zdCBjcmVhdGVIZXhhZ29uUGF0aCA9ICgpID0+IHtcbiAgLy8gQ3JlYXRlIGEgUGFwZXIuanMgUGF0aCB0byBkcmF3IGEgbGluZSBpbnRvIGl0OlxuICB2YXIgaGV4YWdvbiA9IG5ldyBQYXRoKCk7XG5cbiAgdmFyIHBvaW50cyA9IDY7XG4gIHZhciByYWRpdXMgPSBTSEFQRV9SQURJVVMgKiAxLjY7XG4gIHZhciBhbmdsZSA9ICgoMiAqIE1hdGguUEkpIC8gcG9pbnRzKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8PSBwb2ludHM7IGkrKykge1xuICAgIGhleGFnb24uYWRkKG5ldyBQb2ludChcbiAgICAgIHJhZGl1cyAqIE1hdGguY29zKGFuZ2xlICogaSksXG4gICAgICByYWRpdXMgKiBNYXRoLnNpbihhbmdsZSAqIGkpXG4gICAgKSk7XG4gIH1cblxuICBoZXhhZ29uLmZpbGxDb2xvciA9IENPTE9SU1szXTtcblxuICByZXR1cm4gaGV4YWdvbjtcbn07XG5cbmNvbnN0IGNyZWF0ZVJhbmRvbVNoYXBlID0gcG9zID0+IHtcbiAgY29uc3Qgc2hhcGVJbmRleCA9IGNoYW5jZS5pbnRlZ2VyKHsgbWluOiAwLCBtYXg6IDMgfSk7XG4gIGxldCBwYXRoO1xuXG4gIHN3aXRjaCAoc2hhcGVJbmRleCkge1xuICBjYXNlIDA6XG4gICAgcGF0aCA9IGNpcmNsZS5wbGFjZShuZXcgUG9pbnQocG9zLngsIHBvcy55KSk7XG4gICAgYnJlYWs7XG4gIGNhc2UgMTpcbiAgICBwYXRoID0gc3F1YXJlLnBsYWNlKG5ldyBQb2ludChwb3MueCwgcG9zLnkpKTtcbiAgICBicmVhaztcbiAgY2FzZSAyOlxuICAgIHBhdGggPSBoZXhhZ29uLnBsYWNlKG5ldyBQb2ludChwb3MueCwgcG9zLnkpKTtcbiAgICBicmVhaztcbiAgY2FzZSAzOlxuICAgIHBhdGggPSB0cmlhbmdsZS5wbGFjZShuZXcgUG9pbnQocG9zLngsIHBvcy55KSk7XG4gICAgYnJlYWs7XG4gIH1cbiAgcmV0dXJuIHBhdGg7XG59XG5cbmxldCB0b29sO1xuXG53aW5kb3cub25sb2FkID0gKCkgPT4ge1xuICBsZXQgY2hhbmNlID0gbmV3IENoYW5jZSgpO1xuICBsZXQgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xuICB0b29sID0gbmV3IFRvb2woKTtcblxuICBXSURUSCA9IHdpbmRvdy5pbm5lcldpZHRoO1xuICBIRUlHSFQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG5cbiAgY29uc29sZS5sb2coV0lEVEgsIEhFSUdIVCk7XG5cbiAgcGFwZXIuc2V0dXAoY2FudmFzKTtcbiAgcGFwZXIudmlldy5vblJlc2l6ZSA9IG9uUmVzaXplO1xuICBwYXBlci52aWV3Lm9uRnJhbWUgPSBvbkZyYW1lO1xuXG4gIHRvb2wub25Nb3VzZURvd24gPSBvbk1vdXNlRG93bjtcbiAgdG9vbC5vbk1vdXNlRHJhZyA9IG9uTW91c2VEcmFnO1xuXG4gIHNldHVwU2hhcGVzKCk7XG4gIGZpcmVOZXdTaGFwZSgpO1xuXG59O1xuXG5jb25zdCBzZXR1cFNoYXBlcyA9ICgpID0+IHtcbiAgbGV0IGNpcmNsZVBhdGggPSBjcmVhdGVDaXJjbGVQYXRoKCk7XG4gIGxldCBzcXVhcmVQYXRoID0gY3JlYXRlU3F1YXJlUGF0aCgpO1xuICBsZXQgdHJpYW5nbGVQYXRoID0gY3JlYXRlVHJpYW5nbGVQYXRoKCk7XG4gIGxldCBoZXhhZ29uUGF0aCA9IGNyZWF0ZUhleGFnb25QYXRoKCk7XG4gIGxldCB0cmFjZVBhdGggPSBjcmVhdGVUcmFjZVBhdGgoKTtcblxuICBjaXJjbGUgPSBuZXcgU3ltYm9sKGNpcmNsZVBhdGgpO1xuICBzcXVhcmUgPSBuZXcgU3ltYm9sKHNxdWFyZVBhdGgpO1xuICBoZXhhZ29uID0gbmV3IFN5bWJvbChoZXhhZ29uUGF0aCk7XG4gIHRyaWFuZ2xlID0gbmV3IFN5bWJvbCh0cmlhbmdsZVBhdGgpO1xuICB0cmFjZSA9IG5ldyBTeW1ib2wodHJhY2VQYXRoKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IE5VTV9TSEFQRVM7IGkrKykge1xuXG4gICAgbGV0IHBvcyA9IHtcbiAgICAgIHg6IGNoYW5jZS5pbnRlZ2VyKHsgbWluOiAwLCBtYXg6IFdJRFRIIH0pLFxuICAgICAgeTogY2hhbmNlLmludGVnZXIoeyBtaW46IDAsIG1heDogSEVJR0hUIH0pXG4gICAgfTtcblxuICAgIGxldCBwbGFjZWQgPSBjcmVhdGVSYW5kb21TaGFwZShwb3MpO1xuICAgIHBsYWNlZC5yb3RhdGUoY2hhbmNlLmludGVnZXIoeyBtaW46IDAsIG1heDogMTgwIH0pKTtcbiAgICBwbGFjZWQuc2NhbGUoY2hhbmNlLmZsb2F0aW5nKHsgbWluOiAwLjUsIG1heDogMSB9KSk7XG5cbiAgICBwbGFjZWQuZGF0YS5lbGlnaWJsZSA9IHRydWU7XG5cbiAgICBzaGFwZXNBcnIucHVzaChwbGFjZWQpO1xuICB9XG5cblxufTtcblxuY29uc3QgcmVwb3NpdGlvblNoYXBlcyA9ICgpID0+IHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzaGFwZXNBcnIubGVuZ3RoOyBpKyspIHtcblxuICAgIGxldCBwb3MgPSB7XG4gICAgICB4OiBjaGFuY2UuaW50ZWdlcih7IG1pbjogMCwgbWF4OiBXSURUSCB9KSxcbiAgICAgIHk6IGNoYW5jZS5pbnRlZ2VyKHsgbWluOiAwLCBtYXg6IEhFSUdIVCB9KVxuICAgIH07XG5cbiAgICBzaGFwZXNBcnJbaV0ucG9zaXRpb24gPSBwb3M7XG4gIH1cbn07XG5cbmNvbnN0IG9uUmVzaXplID0gdmlldyA9PiB7XG4gIFdJRFRIID0gdmlldy5zaXplLndpZHRoO1xuICBIRUlHSFQgPSB2aWV3LnNpemUuaGVpZ2h0O1xuXG4gIHJlcG9zaXRpb25TaGFwZXMoKTtcbn07XG5cbmNvbnN0IGQyciA9IGRlZyA9PiB7XG4gIHJldHVybiBkZWcgKiBNYXRoLlBJIC8gMTgwO1xufTtcblxuY29uc3Qgb25Db2xsaWRlID0gKGJ1bGxldCwgdGFyZ2V0LCBhbmdsZSkgPT4ge1xuICAvLyBjb25zb2xlLmxvZygnb25Db2xsaWRlJywgYnVsbGV0KTtcbiAgLy8gc2hhcGUgaGFzIGJlZW4gY29sbGlkZWQgd2l0aFxuICAvLyBjcmVhdGUgYSBmZXcgbW9yZSBzaGFwZXMgYXQgaXRzIHBvc2l0aW9uXG4gIC8vIHRoZW4gcmVtb3ZlIGl0XG4gIGJ1bGxldC5yZW1vdmUoKTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IHRyYWNlcy5sZW5ndGg7IGkrKykge1xuICAgIHRyYWNlc1tpXS5yZW1vdmUoKTtcbiAgfVxuXG4gIGNvbnN0IGV4cGxvc2lvblJhZGl1cyA9IGNoYW5jZS5pbnRlZ2VyKHsgbWluOiAyMCwgbWF4OiA2MCB9KTtcbiAgY29uc3QgbnVtUGFydHMgPSA1O1xuICBsZXQgZXhwbG9zaW9uU2hhcGUgPSBjcmVhdGVFeHBsb3Npb25QYXRoKGV4cGxvc2lvblJhZGl1cyk7XG4gIGV4cGxvc2lvblNoYXBlLnBvc2l0aW9uID0gdGFyZ2V0LnBvc2l0aW9uO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtUGFydHM7IGkrKykge1xuXG4gICAgY29uc3QgdGhldGEgPSBhbmdsZSArIChpICogKDE4MCAvIG51bVBhcnRzKSkgLSA5MDtcblxuICAgIGxldCBwb3MgPSB7XG4gICAgICB4OiB0YXJnZXQucG9zaXRpb24ueCArIChleHBsb3Npb25SYWRpdXMgKiBNYXRoLmNvcyhkMnIodGhldGEpKSksXG4gICAgICB5OiB0YXJnZXQucG9zaXRpb24ueSArIChleHBsb3Npb25SYWRpdXMgKiBNYXRoLnNpbihkMnIodGhldGEpKSlcbiAgICB9O1xuXG4gICAgbGV0IHBsYWNlZCA9IGNyZWF0ZVJhbmRvbVNoYXBlKHBvcyk7XG4gICAgcGxhY2VkLnJvdGF0ZShjaGFuY2UuaW50ZWdlcih7IG1pbjogMCwgbWF4OiAxODAgfSkpO1xuICAgIHBsYWNlZC5zY2FsZShjaGFuY2UuZmxvYXRpbmcoeyBtaW46IDAuNSwgbWF4OiAxIH0pKTtcblxuICAgIHBsYWNlZC5kYXRhLmVsaWdpYmxlID0gZmFsc2U7XG4gICAgcGxhY2VkLmRhdGEub3JpZ2luID0gdGFyZ2V0LnBvc2l0aW9uO1xuICAgIHBsYWNlZC5kYXRhLnRoZXRhID0gdGhldGE7XG4gICAgcGxhY2VkLmRhdGEucGFyZW50UG9zaXRpb24gPSB0YXJnZXQucG9zaXRpb247XG5cbiAgICBleHBsb2RpbmdTaGFwZXMucHVzaChwbGFjZWQpO1xuICAgIGluZWxpZ2libGVTaGFwZXMucHVzaChwbGFjZWQpO1xuXG4gICAgc2hhcGVzQXJyLnB1c2gocGxhY2VkKTtcbiAgfVxuXG4gIE5VTV9TSEFQRVMgKz0gbnVtUGFydHMgLSAxO1xuICBleHBsb3Npb25JblByb2dyZXNzID0gdHJ1ZTtcblxuICBmaXJlTmV3U2hhcGUoKTtcblxufTtcblxuY29uc3QgZmlyZU5ld1NoYXBlID0gKCkgPT4ge1xuICBjdXJyZW50QnVsbGV0SW5kZXggPSBjaGFuY2UuaW50ZWdlcih7IG1pbjogMCwgbWF4OiBzaGFwZXNBcnIubGVuZ3RoIC0gMSB9KTtcblxuICAvLyBlbnN1cmUgbm8gbmV3bHkgY3JlYXRlZCBwYXJ0aWNsZXMgYXJlIHRoZSBuZXcgdGFyZ2V0XG4gIGN1cnJlbnRUYXJnZXRJbmRleCA9IGNoYW5jZS5pbnRlZ2VyKHsgbWluOiAwLCBtYXg6IHNoYXBlc0Fyci5sZW5ndGggLSAxIH0pO1xuXG4gIGlmIChzaGFwZXNBcnJbY3VycmVudEJ1bGxldEluZGV4XS5kYXRhLmVsaWdpYmxlXG4gICAgJiYgY3VycmVudEJ1bGxldEluZGV4ICE9PSBjdXJyZW50VGFyZ2V0SW5kZXhcbiAgICAmJiB0eXBlb2Ygc2hhcGVzQXJyW2N1cnJlbnRCdWxsZXRJbmRleF0uX2luZGV4ICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vdmUgPSB0cnVlO1xuICB9IGVsc2Uge1xuICAgIC8vIGNvbnNvbGUud2Fybignbm90IGVsaWdpYmxlJyk7XG4gICAgZmlyZU5ld1NoYXBlKCk7XG4gIH1cblxufTtcblxubGV0IGxhc3RTaGlmdGVkQXQgPSAwO1xubGV0IHNoaWZ0RXZlcnkgPSA2MDtcbmxldCBleHBsb3Npb25JblByb2dyZXNzID0gZmFsc2U7XG5sZXQgdHJhY2VzID0gW107XG5cbmNvbnN0IG9uTW91c2VEb3duID0gZXZlbnQgPT4ge1xuICBjb25zb2xlLmxvZyhldmVudC5wb2ludCk7XG5cbiAgbGV0IHBsYWNlZCA9IGNyZWF0ZVJhbmRvbVNoYXBlKGV2ZW50LnBvaW50KTtcbiAgcGxhY2VkLnJvdGF0ZShjaGFuY2UuaW50ZWdlcih7IG1pbjogMCwgbWF4OiAxODAgfSkpO1xuICBwbGFjZWQuc2NhbGUoY2hhbmNlLmZsb2F0aW5nKHsgbWluOiAwLjUsIG1heDogMSB9KSk7XG5cbiAgcGxhY2VkLmRhdGEuZWxpZ2libGUgPSB0cnVlO1xuICBzaGFwZXNBcnIucHVzaChwbGFjZWQpO1xuICBOVU1fU0hBUEVTKys7XG59O1xuXG5sZXQgbnVtRHJhZ0V2ZW50cyA9IDA7XG5cbmNvbnN0IG9uTW91c2VEcmFnID0gZXZlbnQgPT4ge1xuXG4gIGlmIChudW1EcmFnRXZlbnRzICUgNCA9PT0gMCkge1xuICAgIG9uTW91c2VEb3duKGV2ZW50KTtcblxuICB9XG5cbiAgbnVtRHJhZ0V2ZW50cysrO1xufTtcblxuY29uc3Qgb25GcmFtZSA9IGV2ZW50ID0+IHtcbiAgLy8gY29uc29sZS5sb2coZXZlbnQpO1xuICBpZiAobW92ZSkge1xuICAgIGxldCB2ZWN0b3IgPSBzaGFwZXNBcnJbY3VycmVudFRhcmdldEluZGV4XS5wb3NpdGlvbi5zdWJ0cmFjdChzaGFwZXNBcnJbY3VycmVudEJ1bGxldEluZGV4XS5wb3NpdGlvbik7XG4gICAgY29uc3Qgb3JpZ2luYWxMZW5ndGggPSB2ZWN0b3IubGVuZ3RoO1xuXG4gICAgaWYgKGV2ZW50LmNvdW50ICUgMiA9PT0gMCkge1xuICAgICAgdHJhY2VzLnB1c2godHJhY2UucGxhY2UobmV3IFBvaW50KHNoYXBlc0FycltjdXJyZW50QnVsbGV0SW5kZXhdLnBvc2l0aW9uKSkpO1xuXG4gICAgfVxuXG4gICAgdmVjdG9yLmxlbmd0aCA9IFdJRFRIIC8gMjtcbiAgICBzaGFwZXNBcnJbY3VycmVudEJ1bGxldEluZGV4XS5wb3NpdGlvbiA9IHNoYXBlc0FycltjdXJyZW50QnVsbGV0SW5kZXhdLnBvc2l0aW9uLmFkZCh2ZWN0b3IuZGl2aWRlKDEyMCkpO1xuICAgIHNoYXBlc0FycltjdXJyZW50QnVsbGV0SW5kZXhdLnJvdGF0ZSgxKTtcblxuICAgIGlmIChvcmlnaW5hbExlbmd0aCA8IDUpIHtcblxuICAgICAgbW92ZSA9IGZhbHNlO1xuICAgICAgb25Db2xsaWRlKHNoYXBlc0FycltjdXJyZW50QnVsbGV0SW5kZXhdLCBzaGFwZXNBcnJbY3VycmVudFRhcmdldEluZGV4XSwgdmVjdG9yLmFuZ2xlKTtcbiAgICB9XG4gIH1cblxuICBpZiAoZXhwbG9zaW9uSW5Qcm9ncmVzcykge1xuICAgIC8vIG1vdmUgcGFydHMgb3V0IGZyb20gdGhlaXIgb3JpZ2luXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBleHBsb2RpbmdTaGFwZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCB2ZWN0b3IgPSBleHBsb2RpbmdTaGFwZXNbaV0uZGF0YS5wYXJlbnRQb3NpdGlvbi5zdWJ0cmFjdChleHBsb2RpbmdTaGFwZXNbaV0ucG9zaXRpb24pO1xuICAgICAgaWYgKHZlY3Rvci5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgZXhwbG9kaW5nU2hhcGVzID0gW107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleHBsb2RpbmdTaGFwZXNbaV0ucG9zaXRpb24gPSBleHBsb2RpbmdTaGFwZXNbaV0ucG9zaXRpb24uc3VidHJhY3QodmVjdG9yLmRpdmlkZSgzMDApKTtcbiAgICAgICAgZXhwbG9kaW5nU2hhcGVzW2ldLnJvdGF0ZSgxMCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gZW5hYmxlIG5ldyBzaGFwZXMgYXMgYnVsbGV0cyBhbmQgdGFyZ2V0c1xuICBpZiAoKGV2ZW50LmNvdW50IC0gbGFzdFNoaWZ0ZWRBdCA+IHNoaWZ0RXZlcnkpICYmIGluZWxpZ2libGVTaGFwZXMubGVuZ3RoKSB7XG4gICAgc2hpZnRFdmVyeSA9IGluZWxpZ2libGVTaGFwZXMubGVuZ3RoID4gNTAgPyAxIDogNjA7XG4gICAgaW5lbGlnaWJsZVNoYXBlc1swXS5kYXRhLmVsaWdpYmxlID0gdHJ1ZTtcbiAgICBpbmVsaWdpYmxlU2hhcGVzLnNoaWZ0KCk7XG4gICAgbGFzdFNoaWZ0ZWRBdCA9IGV2ZW50LmNvdW50O1xuICB9XG5cbiAgLy8gdHJpYW5nbGUuZGVmaW5pdGlvbi5yb3RhdGUoMC41KTtcbiAgLy8gc3F1YXJlLmRlZmluaXRpb24ucm90YXRlKDAuNCk7XG4gIC8vIGhleGFnb24uZGVmaW5pdGlvbi5yb3RhdGUoMC4yKTtcblxufTtcbiJdfQ==
